<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>eFinance</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="assets/css/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- <link href="assets/css/jquery.mobile-1.4.5.min.css" rel="stylesheet"> -->

    <!-- Loading Flat UI -->
    <link href="assets/css/flat-ui.min.css" rel="stylesheet">
    <link href="assets/css/custom_style.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="assets/js/vendor/html5shiv.js"></script>
      <script src="assets/js/vendor/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="container" id="centerDiv">

              <!-- Static navbar -->
        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
              </button>
              <a class="navbar-brand" href="#">eFinance</a>
            </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li id="m_dashboard" class="cursor" data-toggle="collapse" data-target=".navbar-collapse"><a href="dashboard.html">Dashboard</a></li>
                <li id="m_sync" class="cursor"><a href="sync.html">Synchronization</a></li>
                <li id="m_logout" class="cursor"><a href="#">Logout</a></li>
              </ul>
            </div><!--/.nav-collapse -->
          </div>
        </div>

        <br><br><br>

          <div id="QR-Code">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    
                    <div class="row">
                      <div class="col-sm-6">
                          <h4>eFinance - Sync</h4>
                      </div>
                      <div class="col-sm-6">
                          <select id="cameraId" class="form-control" style="display: inline-block;width: auto;"></select><br>
                          <button id="save" data-toggle="tooltip" title="Image shoot" type="button" class="btn btn-info btn-sm disabled"><span class="glyphicon glyphicon-picture"></span></button>
                          <button id="play" data-toggle="tooltip" title="Play" type="button" class="btn btn-success btn-sm"><span class="glyphicon glyphicon-play"></span></button>
                          <button id="stop" data-toggle="tooltip" title="Stop" type="button" class="btn btn-warning btn-sm"><span class="glyphicon glyphicon-stop"></span></button>
                          <button id="stopAll" data-toggle="tooltip" title="Stop streams" type="button" class="btn btn-danger btn-sm"><span class="glyphicon glyphicon-stop"></span></button>
                      </div>
                    </div>

                </div>
                <div class="panel-body">

                  <div class="row">
                    <div class="col-sm-6" style="text-align: center;">
                        <div class="well">
                            <canvas id="qr-canvas" width="100%" height="200px"></canvas>
                            <div class="scanner-laser laser-rightBottom" style="opacity: 0.5;"></div>
                            <div class="scanner-laser laser-rightTop" style="opacity: 0.5;"></div>
                            <div class="scanner-laser laser-leftBottom" style="opacity: 0.5;"></div>
                            <div class="scanner-laser laser-leftTop" style="opacity: 0.5;"></div>
                        </div>
                        <!-- <div class="well" style="position: relative;" >
                            <label id="zoom-value" width="100">Zoom: 2</label>
                            <input type="range" id="zoom" value="20" min="10" max="30" onchange="Page.changeZoom();"/>
                            <label id="brightness-value" width="100">Brightness: 0</label>
                            <input type="range" id="brightness" value="0" min="0" max="128" onchange="Page.changeBrightness();"/>
                            <label id="contrast-value" width="100">Contrast: 0</label>
                            <input type="range" id="contrast" value="0" min="0" max="64" onchange="Page.changeContrast();"/>
                            <label id="threshold-value" width="100">Threshold: 0</label>
                            <input type="range" id="threshold" value="0" min="0" max="512" onchange="Page.changeThreshold();"/>
                            <label id="sharpness-value" width="100">Sharpness: off</label>
                            <input type="checkbox" id="sharpness" onchange="Page.changeSharpness();"/>
                            <label id="grayscale-value" width="100">grayscale: off</label>
                            <input type="checkbox" id="grayscale" onchange="Page.changeGrayscale();"/>
                        </div> -->
                    </div>
                    <div class="col-sm-6" style="text-align: center;">
                        <div id="result" class="thumbnail">
                            <div class="well">
                                <img id="scanned-img" src="" width="100%" height="200px">
                            </div>
                            <div class="caption">
                                <strong>Scanned result</strong><br>
                                <p id="scanned-QR"></p>
                                <input type="hidden" name="scanned-QR-url" id="scanned-QR-url">
                  
    <input type="button" name="btn_proceed_s2c" id="btn_proceed_s2c" value="Proceed Server2Client Sync" class="btn btn-success btn-sm btn-embossed btn-block" /> 
    <input type="button" name="btn_proceed_c2s" id="btn_proceed_c2s" value="Proceed Client2Server Sync" class="btn btn-success btn-sm btn-embossed btn-block" /> 

                            </div>
                        </div>
                    </div>
                </div>

              </div>

            </div>
          </div>

          <div align="center">
          <br>
          <h3>OR</h3>

          <div class="row">
            <div class="col-sm-12">
              <input type="text" id="manual_url" name="manual_url" class="form-control" placeholder="Enter URL"><br>
              <input type="button" id="manual_s2c" name="manual_s2c" class="btn btn-sm btn-info btn-embossed btn-block" value="Manual Server2Client"> 
              <input type="button" id="manual_c2s" name="manual_c2s" class="btn btn-sm btn-info btn-embossed btn-block" value="Manual Client2Server"> 
            </div>
          </div>
          </div>
          <br><br>
    </div>
    <!-- /.container -->

    <!-- jQuery (necessary for Flat UI's JavaScript plugins) -->
    <script src="cordova.js"></script>
    <script src="assets/js/vendor/jquery.min.js"></script>
    <!--<script src="assets/js/jquery.mobile-1.4.5.min.js"></script>-->
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="assets/js/vendor/video.js"></script>
    <script src="assets/js/flat-ui.min.js"></script>
    <script src="assets/js/efinance_app.js"></script>

    <script type="text/javascript" src="assets/qrcode/js/qrcodelib.js"></script>
    <script type="text/javascript" src="assets/qrcode/js/WebCodeCam.js"></script>
    <script type="text/javascript" src="assets/qrcode/js/main.js"></script>

    <script type="text/javascript">

      $(document).ready(function(){

          //$("#centerDiv").center();

          // Checkboxes and Radio buttons
          $('[data-toggle="checkbox"]').radiocheck();

          //$('#btn_proceed_s2c').prop('disabled', true);
          //$('#btn_proceed_c2s').prop('disabled', true);

          $(document).on("click", "#manual_s2c", function(){

              var manual_url = $("#manual_url").val();

              var isValidURL = learnRegExp(manual_url);
              console.log(isValidURL);

              if(manual_url!="" && isValidURL==true)
              {                
                  var data = { type: "sync", lastsync: getCurrentDateDBFormat() };

                  manual_url = manual_url +"s2c.php";
                  //manual_url = manual_url +"s2c.php?type=sync&lastsync="+getCurrentDateDBFormat();

                  alert("manual_url v1 : "+manual_url);
                  /*$.get(manual_url, function (data) {
                      fnServer2ClientResult(data);
                  });*/
                  
                  $.ajax({
                      crossDomain: true,
                      type: "POST",
                      contentType: "application/json; charset=utf-8",
                      async:false,
                      url: manual_url,
                      data: data,
                      dataType: "json",
                      success: function(data, status){
                        alert("Data Loaded");
                        fnServer2ClientResult(data);
                      },
                      error: function(xhr, status, error) {
                          alert("AJAX CALL FAILED!!!");
                          alert(xhr.responseText);
                          alert(error);
                       }
                  });
                  
              }else{
                alert("URL is Empty OR Not a Valid URL!.. Try Again Later!!!");
              }
          
          });

          $(document).on("click", "#btn_proceed_s2c", function(){

            var http = location.protocol;
            var slashes = http.concat("//");
            var host = slashes.concat(window.location.hostname);

            var scanned_QR_url = $("#scanned-QR-url").val();
            //var newurl = host+"/eFinance/ws/s2c.php";

            if(scanned_QR_url!="")
            {
                scanned_QR_url = $("#scanned-QR-url").val()+"s2c.php";

                var data = { type: "sync", lastsync: getCurrentDateDBFormat() };

                $.ajax({
                    crossDomain: true,
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    async:false,
                    url: scanned_QR_url,
                    data: data,
                    dataType: "jsonp",                
                    jsonpCallback: "fnServer2ClientResult"
                });

            }else{
              alert("URL is Empty!... Try Again Later!!!");
            }
            

            //callAjax(data);
            
            //var scanned_QR_url = $("#scanned-QR-url").val()+"s2c.php";
            //alert("scanned_QR_url : "+scanned_QR_url);

          });

          $(document).on("click", "#btn_proceed_c2s", function(){

            var scanned_QR_url = $("#scanned-QR-url").val();

            //alert("scanned_QR_url : "+scanned_QR_url);

            if(scanned_QR_url!="")
            {
                scanned_QR_url = $("#scanned-QR-url").val()+"c2s.php";

                efDB.webdb.getLastSyncDate();
                efDB.webdb.syncLocalDB2Server(scanned_QR_url);
            }else{
              alert("URL is Empty!... Try Again Later!!!");
            }

          });

          $(document).on("click", "#manual_c2s", function(){

              var manual_url = $("#manual_url").val();

              var isValidURL = learnRegExp(manual_url);

              if(manual_url!="" && isValidURL==true)
              {

                manual_url = manual_url +"s2c.php";

                efDB.webdb.getLastSyncDate();
                efDB.webdb.syncLocalDB2Server(manual_url);
                
              }else{
                alert("URL is Empty OR Not a Valid URL!!!. Try Again Later!!!");
              }

          });

      });

      function learnRegExp(s) {
            var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
            return regexp.test(s);
      }

    </script>

  </body>
</html>
